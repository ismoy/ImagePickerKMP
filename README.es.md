<p align="center">
  <a href="https://github.com/ismoy/ImagePickerKMP/actions"><img src="https://github.com/ismoy/ImagePickerKMP/workflows/CI/badge.svg" alt="CI"></a>
  <a href="https://codecov.io/gh/ismoy/ImagePickerKMP"><img src="https://codecov.io/gh/ismoy/ImagePickerKMP/branch/main/graph/badge.svg" alt="Code Coverage"></a>
  <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License"></a>
  <a href="https://kotlinlang.org"><img src="https://img.shields.io/badge/Kotlin-1.9.0-blue.svg" alt="Kotlin"></a>
</p>

<p align="center">
  <a href="https://kotlinlang.org/docs/multiplatform.html"><img src="https://img.shields.io/badge/Platform-Android%20%7C%20iOS-lightgrey.svg" alt="Platform"></a>
  <a href="https://search.maven.org/artifact/io.github.ismoy/imagepickerkmp"><img src="https://img.shields.io/maven-central/v/io.github.ismoy/imagepickerkmp.svg?label=Maven%20Central" alt="Maven Central"></a>
  <a href="https://github.com/ismoy/ImagePickerKMP/releases"><img src="https://img.shields.io/github/v/release/ismoy/ImagePickerKMP?label=GitHub%20Release" alt="GitHub Release"></a>
  <a href="https://github.com/ismoy/ImagePickerKMP/stargazers"><img src="https://img.shields.io/github/stars/ismoy/ImagePickerKMP?style=social" alt="GitHub Repo stars"></a>
</p>

<p align="center">
  <a href="https://github.com/ismoy/ImagePickerKMP/commits/main"><img src="https://img.shields.io/github/last-commit/ismoy/ImagePickerKMP" alt="GitHub last commit"></a>
  <a href="https://github.com/ismoy/ImagePickerKMP/pulls"><img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square" alt="PRs Welcome"></a>
  <a href="https://discord.gg/EjSQTeyh"><img src="https://img.shields.io/discord/1393705692484993114.svg?label=Discord&logo=discord&color=7289da" alt="Discord"></a>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Compose%20Multiplatform-green" alt="Compose Multiplatform">
  <img src="https://img.shields.io/badge/Platform-Android-green" alt="Android">
  <img src="https://img.shields.io/badge/Platform-iOS-blue" alt="iOS">
  <img src="https://img.shields.io/codecov/c/github/ismoy/ImagePickerKMP" alt="Coverage Status">
  <a href="https://github.com/ismoy/ImagePickerKMP/actions/workflows/detekt.yml"><img src="https://github.com/ismoy/ImagePickerKMP/actions/workflows/detekt.yml/badge.svg?branch=main" alt="Detekt"></a>
</p>

## Demo

<video width="100%" autoplay loop muted playsinline>
  <source src="https://user-images.githubusercontent.com/ismoy/ImagePickerKMP/main/demo/demo.mp4" type="video/mp4">
  Tu navegador no soporta el elemento de video.
</video>

*¬°Mira el demo de arriba para ver ImagePickerKMP en acci√≥n - captura de c√°mara, selecci√≥n de galer√≠a y UI personalizada en funcionamiento!*

### Funcionalidades Mostradas en el Demo:
- ** Captura de C√°mara**: Acceso directo a la c√°mara con control de flash
- ** Cambio de C√°mara**: Alternancia fluida entre c√°mara frontal y trasera
- ** UI Personalizada**: Di√°logos de confirmaci√≥n personalizados
- ** Selecci√≥n de Galer√≠a**: Selecci√≥n m√∫ltiple de im√°genes desde la galer√≠a
- ** Rendimiento**: Interacciones suaves y responsivas
- ** Permisos**: Manejo inteligente de permisos

<h1 align="center">ImagePickerKMP</h1>

<p align="center">
  <a href="https://search.maven.org/search?q=g:%22io.github.ismoy%22%20AND%20a:%22imagepickerkmp%22"><img src="https://img.shields.io/maven-central/v/io.github.ismoy/imagepickerkmp.svg?label=Maven%20Central" alt="Maven Central"></a>
  <a href="http://kotlinlang.org"><img src="https://img.shields.io/badge/kotlin-1.9.20-blue.svg?logo=kotlin" alt="Kotlin"></a>
  <a href="https://github.com/JetBrains/compose-multiplatform"><img src="https://img.shields.io/badge/Compose%20Multiplatform-1.5.11-blue" alt="Compose Multiplatform"></a>
  <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a>
</p>

<p align="center">
  Una librer√≠a moderna de Kotlin Multiplatform para captura de im√°genes y selecci√≥n de galer√≠a, dise√±ada espec√≠ficamente para <strong>Compose Multiplatform</strong>. Proporciona una API unificada y nativa para Android e iOS con personalizaci√≥n completa de UI.
</p>

---

<h2 align="center"> Acerca de ImagePickerKMP</h2>

<p align="center">
   <strong>Soporte Multiplataforma</strong>: Android e iOS con una sola API<br>
   <strong>Integraci√≥n de C√°mara</strong>: Captura directa con vista previa<br>
   <strong>Selecci√≥n de Galer√≠a</strong>: Simple y m√∫ltiple selecci√≥n<br>
   <strong>UI Personalizable</strong>: Di√°logos y vistas completamente personalizables<br>
   <strong>Manejo de Permisos</strong>: Gesti√≥n autom√°tica e inteligente
</p>

---

##  Caracter√≠sticas

-  **Soporte Nativo Multiplataforma**: Android e iOS con una sola API
-  **Captura de C√°mara**: Acceso directo a la c√°mara con vista previa
-  **Selecci√≥n de Galer√≠a**: Selecci√≥n simple y m√∫ltiple de im√°genes
-  **UI Completamente Personalizable**: Di√°logos, vistas de confirmaci√≥n y UI de c√°mara personalizables
-  **Manejo Inteligente de Permisos**: Gesti√≥n autom√°tica de permisos con alternativas elegantes
-  **Optimizado para Rendimiento**: Procesamiento eficiente de im√°genes
-  **API Simple**: F√°cil integraci√≥n con manejo integral de errores
-  **Soporte de Internacionalizaci√≥n**: Textos personalizables para m√∫ltiples idiomas

##  Instalaci√≥n

### Gradle (Kotlin DSL)

```kotlin
commonMain {
    dependencies {
        implementation("io.github.ismoy:imagepickerkmp:1.0.2")
    }
}
```

### Gradle (Groovy)

```groovy
commonMain {
    dependencies {
        implementation 'io.github.ismoy:imagepickerkmp:1.0.2'
    }
}
```

<h2 align="center"> Inicio R√°pido</h2>

### Captura de C√°mara

```kotlin
@Composable
fun MiCapturaCamara() {
    var mostrarCamara by remember { mutableStateOf(false) }
    var fotoCapturada by remember { mutableStateOf<CameraPhotoHandler.PhotoResult?>(null) }

    if (mostrarCamara) {
        ImagePickerLauncher(
            config = ImagePickerConfig(
                onPhotoCaptured = { result ->
                    fotoCapturada = result
                    mostrarCamara = false
                },
                onError = {
                    mostrarCamara = false
                },
                onDismiss = {
                    mostrarCamara = false // Resetear estado cuando el usuario no selecciona nada
                },
                // Di√°logo personalizado solo iOS opcional
                customPickerDialog = { onTakePhoto, onSelectFromGallery, onCancel ->
                    MiBottomSheetPersonalizado(
                        onTakePhoto = onTakePhoto,
                        onSelectFromGallery = onSelectFromGallery,
                        onDismiss = {
                            onCancel()
                            mostrarCamara = false
                        }
                    )
                },
                // Solo Android opcional
                cameraCaptureConfig = CameraCaptureConfig(
                    permissionAndConfirmationConfig = PermissionAndConfirmationConfig(
                        customConfirmationView = { photoResult, onConfirm, onRetry ->
                            TuVistaConfirmacionPersonalizada(
                                result = photoResult,
                                onConfirm = onConfirm,
                                onRetry = onRetry
                            )
                        }
                    )
                )
            )
        )
    }

    Button(onClick = { mostrarCamara = true }) {
        Text("Tomar Foto")
    }
}
```

### Selecci√≥n de Galer√≠a

```kotlin
@Composable
fun MiSelectorGaleria() {
    var mostrarGaleria by remember { mutableStateOf(false) }
    var imagenesSeleccionadas by remember { mutableStateOf<List<GalleryPhotoHandler.PhotoResult>>(emptyList()) }

    if (mostrarGaleria) {
        GalleryPickerLauncher(
            onPhotosSelected = { fotos ->
                imagenesSeleccionadas = fotos
                mostrarGaleria = false
            },
            onError = { error ->
                mostrarGaleria = false
            },
            onDismiss = { 
                println("Usuario cancel√≥ o cerr√≥ el selector")
                mostrarGaleria = false // Resetear estado cuando el usuario no selecciona nada
            },
            allowMultiple = true, // False para selecci√≥n simple
            mimeTypes = listOf("image/jpeg", "image/png"), // Opcional: filtrar por tipo
            // Solo Android opcional
            cameraCaptureConfig = CameraCaptureConfig(
                permissionAndConfirmationConfig = PermissionAndConfirmationConfig(
                    customConfirmationView = { photoResult, onConfirm, onRetry ->
                        TuVistaConfirmacionPersonalizada(
                            result = photoResult,
                            onConfirm = onConfirm,
                            onRetry = onRetry
                        )
                    }
                )
            )
        )
    }

    Button(onClick = { mostrarGaleria = true }) {
        Text("Elegir de la Galer√≠a")
    }
}
```
Para m√°s personalizaci√≥n (vistas de confirmaci√≥n, filtrado MIME, etc.), [consulta la gu√≠a de integraci√≥n para KMP.](https://github.com/ismoy/ImagePickerKMP/blob/main/docs/INTEGRATION_GUIDE.es.md#kotlin-multiplatform--compose-multiplatform)

### Uso de ImagePickerKMP en Android Nativo (Jetpack Compose)
<p>Incluso si no est√°s usando KMP, puedes usar ImagePickerKMP en proyectos Android puros con Jetpack Compose.</p>

#### Paso 1: Agregar la dependencia
```kotlin
implementation("io.github.ismoy:imagepickerkmp:1.0.2")
```
#### Paso 2: Ejemplo de Lanzador de C√°mara
```kotlin
var mostrarCamara by remember { mutableStateOf(false) }
var fotoCapturada by remember { mutableStateOf<CameraPhotoHandler.PhotoResult?>(null) }
```
```kotlin
if (mostrarCamara) {
    ImagePickerLauncher(
        config = ImagePickerConfig(
            onPhotoCaptured = { result ->
                fotoCapturada = result
                mostrarCamara = false
            },
            onError = {
                mostrarCamara = false
            },
            onDismiss = {
                mostrarImagePicker = false // Resetear estado cuando el usuario no selecciona nada
            },
            // Di√°logo personalizado solo iOS opcional
            customPickerDialog = { onTakePhoto, onSelectFromGallery, onCancel ->
                MiBottomSheetPersonalizado(
                    onTakePhoto = onTakePhoto,
                    onSelectFromGallery = onSelectFromGallery,
                    onDismiss = {
                        isPickerSheetVisible = false
                        onCancel()
                        mostrarCameraPicker = false
                    }
                )
            },
            // Solo Android opcional
            cameraCaptureConfig = CameraCaptureConfig(
                permissionAndConfirmationConfig = PermissionAndConfirmationConfig(
                    customConfirmationView = { photoResult, onConfirm, onRetry ->
                        TuVistaConfirmacionPersonalizada(
                            result = photoResult,
                            onConfirm = onConfirm,
                            onRetry = onRetry
                        )
                    },
                    // Opcional: manejador de permisos personalizado
                    customPermissionHandler = { config ->
                        // Manejar permisos aqu√≠
                    }
                )
            )
        )
    )
}

Button(onClick = { mostrarCamara = true }) {
    Text("Tomar Foto")
}
```

#### Paso 3: Ejemplo de Selector de Galer√≠a
```kotlin
var mostrarGaleria by remember { mutableStateOf(false) }
var imagenesSeleccionadas by remember { mutableStateOf<List<GalleryPhotoHandler.PhotoResult>>(emptyList()) }
```
```kotlin
if (mostrarGaleria) {
    GalleryPickerLauncher(
        onPhotosSelected = { fotos ->
            imagenesSeleccionadas = fotos
            mostrarGaleria = false
        },
        onError = { error ->
            mostrarGaleria = false
        },
        onDismiss = {
            mostrarCamara = false
           },
        allowMultiple = true, // False para selecci√≥n simple
        mimeTypes = listOf("image/jpeg", "image/png"), // Opcional: filtrar por tipo
        // Solo Android opcional
        cameraCaptureConfig = CameraCaptureConfig(
            permissionAndConfirmationConfig = PermissionAndConfirmationConfig(
                customConfirmationView = { photoResult, onConfirm, onRetry ->
                    TuVistaConfirmacionPersonalizada(
                        result = photoResult,
                        onConfirm = onConfirm,
                        onRetry = onRetry
                    )
                }
            )
        )
    )
}

Button(onClick = { mostrarGaleria = true }) {
    Text("Elegir de la Galer√≠a")
}
```
Consulta la [gu√≠a de integraci√≥n nativa de Android](https://github.com/ismoy/ImagePickerKMP/blob/main/docs/INTEGRATION_GUIDE.es.md#android-nativo-jetpack-compose) para m√°s detalles de uso.

- En **Android**, el usuario ver√° el selector de galer√≠a del sistema.
- En **iOS**, se usa el selector nativo de galer√≠a. En iOS 14+ se soporta selecci√≥n m√∫ltiple. El sistema gestiona permisos y acceso limitado de forma nativa.
- El callback `onPhotosSelected` siempre recibe una lista, incluso para selecci√≥n simple.
- Puedes usar `allowMultiple` para habilitar o deshabilitar la selecci√≥n m√∫ltiple de im√°genes.
- El par√°metro `mimeTypes` es opcional y permite filtrar los tipos de archivos seleccionables.

## Correcci√≥n de Cierre de GalleryPickerLauncher

El `GalleryPickerLauncher` ahora incluye un callback `onDismiss` para manejar los casos donde los usuarios cierran el selector sin seleccionar ninguna imagen. Esto resuelve el problema donde el selector no se pod√≠a volver a abrir despu√©s de ser cerrado.

El callback `onDismiss` se activa cuando:
- Usuario cancela el di√°logo de selecci√≥n (Android)
- Usuario toca "Cancelar" (iOS)
- Usuario cancela la solicitud de permisos de c√°mara (iOS)
- Usuario cancela la interfaz de c√°mara (toca "Cancel" o "X") (iOS)

<h2 align="center"> Soporte de Plataformas</h2>

<p align="center">
  <strong>Compatibilidad multiplataforma con gesti√≥n autom√°tica de contexto</strong>
</p>

- **ü§ñ Android:** La librer√≠a gestiona autom√°ticamente el contexto usando `LocalContext.current`. No es necesario pasar el contexto manualmente.
- ** iOS:** No se requiere contexto ya que la librer√≠a usa APIs nativas de iOS.

| Plataforma              | Versi√≥n M√≠nima | Estado |
|-------------------------|----------------|--------|
| Android                 | API 21+        | ‚úÖ     |
| iOS                     | iOS 12.0+      | ‚úÖ     |
| Compose Multiplatform   | 1.5.0+         | ‚úÖ     |

<h2 align="center"> ¬øPor qu√© elegir ImagePickerKMP?</h2>

<p align="center">
  <strong>La librer√≠a m√°s completa y amigable para desarrolladores en Kotlin Multiplatform</strong>
</p>

### Comparaci√≥n con Otras Librer√≠as

| Caracter√≠stica                     | ImagePickerKMP | Peekaboo        | KMPImagePicker   |
|-----------------------------------|----------------|-----------------|------------------|
| **Soporte Compose Multiplatform** | ‚úÖ Nativo      | ‚ùå Solo Android  | ‚ö†Ô∏è Limitado       |
| **Personalizaci√≥n de UI**         | ‚úÖ Control total | ‚ö†Ô∏è B√°sico         | ‚ö†Ô∏è B√°sico         |
| **Permisos Unificados**           | ‚úÖ Manejo inteligente | ‚ùå Manual      | ‚ö†Ô∏è Espec√≠fico por plataforma |
| **Manejo de Errores**             | ‚úÖ Integral | ‚ö†Ô∏è B√°sico        | ‚ö†Ô∏è B√°sico         |
| **Integraci√≥n de C√°mara**         | ‚úÖ Acceso directo | ‚úÖ Acceso directo | ‚ö†Ô∏è Solo galer√≠a  |
| **Soporte de Galer√≠a**            | ‚úÖ Selecci√≥n m√∫ltiple | ‚úÖ Selecci√≥n m√∫ltiple | ‚úÖ Selecci√≥n m√∫ltiple |
| **API Multiplataforma**           | ‚úÖ C√≥digo √∫nico | ‚ùå Espec√≠fico por plataforma | ‚ö†Ô∏è Parcial  |

### Ventajas Clave

- ** Nativo de Compose Multiplatform**: Construido espec√≠ficamente para Compose Multiplatform, garantizando comportamiento consistente en todas las plataformas
- ** Personalizaci√≥n Completa de UI**: Control total sobre di√°logos, vistas de confirmaci√≥n y UI de c√°mara
- ** Manejo Inteligente de Permisos**: Gesti√≥n unificada de permisos con alternativas inteligentes
- ** Optimizado para Rendimiento**: Procesamiento eficiente de im√°genes y gesti√≥n de memoria
- ** Amigable para Desarrolladores**: API simple con manejo integral de errores

## Requisitos

### Android
- SDK m√≠nimo: 21
- Kotlin 1.8+
- Compose Multiplatform

### iOS
- iOS 12.0+
- Xcode 14+
- Kotlin Multiplatform

## Integraci√≥n Espec√≠fica por Plataforma

### Android Nativo (Jetpack Compose)

Para la gu√≠a detallada de integraci√≥n en Android, consulta: [Gu√≠a de Integraci√≥n Android](docs/INTEGRATION_GUIDE.md#android-native-jetpack-compose)

### iOS Nativo (Swift/SwiftUI)

Para la gu√≠a detallada de integraci√≥n en iOS, consulta: [Gu√≠a de Integraci√≥n iOS](docs/INTEGRATION_GUIDE.md#ios-native-swiftswiftui)

### Kotlin Multiplatform/Compose Multiplatform

Para la gu√≠a detallada de integraci√≥n en KMP, consulta: [Gu√≠a de Integraci√≥n Kotlin Multiplatform](docs/INTEGRATION_GUIDE.es.md#kotlin-multiplatform--compose-multiplatform)

<h2 align="center"> Documentaci√≥n</h2>

<p align="center">
  <strong>Gu√≠as completas y documentaci√≥n detallada</strong>
</p>

-  [Gu√≠a de Integraci√≥n](docs/INTEGRATION_GUIDE.es.md) - Gu√≠a completa de configuraci√≥n e integraci√≥n
-  [Gu√≠a de Personalizaci√≥n](docs/CUSTOMIZATION_GUIDE.es.md) - Personalizaci√≥n de UI y comportamiento
-  [Gu√≠a de Internacionalizaci√≥n](docs/I18N_GUIDE.es.md) - Gu√≠a de soporte multilenguaje
-  [Gu√≠a de Permisos](library/PERMISSION.es.md) - Detalles del manejo de permisos
-  [Gu√≠a de Cobertura](docs/COVERAGE_GUIDE.es.md) - Gu√≠a de cobertura de c√≥digo y testing
-  [Configuraci√≥n de Notificaciones](docs/NOTIFICATIONS_SETUP.es.md) - Configuraci√≥n de notificaciones de Discord
-  [Referencia de API](docs/API_REFERENCE.es.md) - Documentaci√≥n completa de la API
-  [Ejemplos](docs/EXAMPLES.es.md) - Ejemplos de c√≥digo y casos de uso

<h2 align="center"> Contribuir</h2>

<p align="center">
  <strong>¬°Aceptamos contribuciones de la comunidad!</strong><br>
  Consulta nuestra <a href="docs/CONTRIBUTING.es.md">Gu√≠a de Contribuci√≥n</a> para m√°s detalles.
</p>

---

<h2 align="center"> Licencia</h2>

<p align="center">
  Este proyecto est√° licenciado bajo la <strong>Licencia MIT</strong><br>
  Consulta el archivo <a href="docs/LICENSE">LICENSE</a> para m√°s detalles.
</p>

---

<h2 align="center"> Soporte y Comunidad</h2>

<p align="center">
  <strong>Obt√©n ayuda, reporta problemas o √∫nete a nuestra comunidad</strong>
</p>

<p align="center">
  <a href="mailto:belizairesmoy72@gmail.com">üìß Email</a> ‚Ä¢ 
  <a href="https://github.com/ismoy/ImagePickerKMP/issues">üêõ Issues</a> ‚Ä¢ 
  <a href="https://github.com/ismoy/ImagePickerKMP/wiki">üìñ Wiki</a> ‚Ä¢ 
  <a href="https://discord.gg/EjSQTeyh">üí¨ Discord</a>
</p>

<h2 align="center"> Changelog</h2>

<p align="center">
  Consulta <a href="docs/CHANGELOG.es.md">CHANGELOG.es.md</a> para una lista completa de cambios y actualizaciones.
</p>

---

<p align="center">
  <strong>Hecho con ‚ù§Ô∏è para la comunidad Kotlin Multiplatform</strong><br>
  <em>¬°Dale una estrella ‚≠ê a este repo si te ayud√≥!</em>
</p>

<p align="center">
  <a href="https://github.com/ismoy/ImagePickerKMP/stargazers">‚≠ê Estrella en GitHub</a> ‚Ä¢ 
  <a href="https://github.com/ismoy/ImagePickerKMP/fork">üç¥ Fork</a> ‚Ä¢ 
  <a href="https://github.com/ismoy/ImagePickerKMP/issues/new">üêõ Reportar Bug</a> ‚Ä¢ 
  <a href="https://github.com/ismoy/ImagePickerKMP/issues/new">üí° Solicitar Feature</a>
</p>